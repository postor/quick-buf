<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <button>click me and check console network tab!</button>
  <script src="/quick-buf.umd.js"></script>
  <script>
    document.querySelector('button').addEventListener('click', async () => {
      await fetch('/api/json1').then(res => res.json()).then(data => console.log('json1', data))
      await fetch('/api/buf1-auto').then(res => res.arrayBuffer()).then(buf =>
        console.log('buf1-auto', QuickBuf.decode(buf)))
      await fetch('/api/buf1-structure').then(res => res.arrayBuffer()).then(buf =>
        console.log('buf1-structure', QuickBuf.decode(buf, getStructure1())))
      await fetch('/api/json2').then(res => res.json()).then(data => console.log('json2', data))
      await fetch('/api/buf2-auto').then(res => res.arrayBuffer()).then(buf =>
        console.log('buf2-auto', QuickBuf.decode(buf)))
      await fetch('/api/buf2-structure').then(res => res.arrayBuffer()).then(buf =>
        console.log('buf2-structure', QuickBuf.decode(buf, getStructure2())))
    })

    function getStructure2() {
      return {
        "type": "string",
        "version": "string",
        "metadata": {
          "geographicalExtent": [
            "float",
            6
          ]
        },
        "CityObjects": [
          {
            "type": "string",
            "geometry": [
              {
                "type": "string",
                "boundaries": [
                  [
                    [
                      "float",
                      3
                    ],
                    1
                  ]
                ],
                "semantics": {
                  "values": [
                    "uint"
                  ],
                  "surfaces": [
                    {
                      "type": "string"
                    }
                  ]
                },
                "texture": {
                  "Rhino   texturing": {
                    "values": [
                      [
                        [
                          "uint",
                          4
                        ],
                        1
                      ]
                    ]
                  }
                },
                "lod": "uint"
              }
            ],
            "id": "string"
          }
        ],
        "vertices": [
          [
            "float",
            3
          ]
        ],
        "appearance": {
          "textures": [
            {
              "type": "string",
              "image": "string",
              "wrapMode": "string",
              "textureType": "string",
              "borderColor": [
                "uint",
                4
              ]
            }
          ],
          "vertices-texture": [
            [
              "float",
              2
            ]
          ]
        }
      }
    }

    function getStructure1() {
      return {
        "source": "string",
        "feeds": [
          {
            "c_d0_method": "string",
            "gps_lat": "number",
            "gps_num": "uint",
            "s_d1": "uint",
            "name": "string",
            "s_t0": "number",
            "area": "string",
            "SiteName": "string",
            "timestamp": "string",
            "app": "string",
            "gps_fix": "uint",
            "gps_lon": "number",
            "SiteAddr": "string",
            "time": "string",
            "s_d0": "uint",
            "gps_alt": "uint",
            "date": "string",
            "s_d2": "uint",
            "s_h0": "number",
            "c_d0": "number",
            "device_id": "string"
          }
        ],
        "version": "string",
        "descriptions": {
          "gps_lat": "string",
          "gps_num": "string",
          "s_g8": "string",
          "s_b0": "string",
          "FAKE_GPS": "string",
          "s_t0": "string",
          "gps_alt": "string",
          "lon": "string",
          "gps_lon": "string",
          "s_d2": "string",
          "s_g8e": "string",
          "s_d0": "string",
          "s_d1": "string",
          "lat": "string",
          "s_h0": "string",
          "s_gg": "string",
          "c_d0": "string",
          "c_d0_method": "string"
        },
        "num_of_records": "uint"
      }
    }
  </script>
</body>

</html>